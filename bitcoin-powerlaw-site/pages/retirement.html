<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retirement Calculator - Bitcoin Power Law Observatory</title>
  <meta name="description" content="Plan retirement with the Storm Navigation framework. Split your Bitcoin stack into a Navigation Fund and Forever Half using power law projections.">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Power Law Observatory
      </a>
      <nav class="nav" aria-label="Main navigation">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">History</a>
        <a href="future.html">Future</a>
        <a href="dca.html">DCA</a>
        <a href="equity.html">Mortgage</a>
        <a href="balance-sheet.html">Balance Sheet</a>
        <a href="retirement.html" class="active">Retirement</a>
        <a href="about.html">About</a>
      </nav>
      <div class="lang-toggle">
        <a href="retirement.html" class="lang-link active">EN</a>
        <span class="lang-sep">|</span>
        <a href="../nl/pages/retirement.html" class="lang-link">NL</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Storm Navigation Retirement Calculator</h1>
        <p>Half your stack navigates the storm. The other half grows forever along the power law.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Important:</strong> This is an educational tool based on power law models, not financial advice. The model assumes the power law continues to hold. Real outcomes will vary. Always do your own research and consult professionals.</p>
      </div>

      <!-- ── Mode Toggle ─────────────────────────────── -->
      <div class="mode-toggle" id="v2-mode-toggle">
        <button class="toggle-btn active" data-mode="freedom_now">Freedom Now</button>
        <button class="toggle-btn" data-mode="end_result">End Result</button>
      </div>

      <!-- ── Input Section ───────────────────────────── -->
      <div class="card" id="v2-input-section">

        <!-- Shared Inputs -->
        <h3>Your Stack</h3>
        <div class="input-grid">
          <div class="input-group">
            <label for="v2-total-btc">Total Bitcoin Holdings (BTC)</label>
            <input type="number" id="v2-total-btc" value="1.0" min="0.001" step="0.01">
          </div>

          <div class="input-group">
            <label for="v2-currency">Currency</label>
            <select id="v2-currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">&euro; EUR</option>
            </select>
          </div>

          <div class="input-group">
            <label for="v2-price-scenario">Price Scenario</label>
            <select id="v2-price-scenario">
              <option value="cyclical" selected>Cyclical (&plusmn;1&sigma;, lengthening periods)</option>
              <option value="cyclical_bear">Bear Bias Cycles (60% below trend)</option>
              <option value="smooth_trend">Smooth Trend (flat on trend)</option>
              <option value="smooth_bear">Bear (flat &minus;1&sigma; below trend)</option>
              <option value="smooth_deep_bear">Deep Bear (flat &minus;2&sigma; below trend)</option>
            </select>
          </div>
        </div>

        <!-- Navigation Fund / Forever Split -->
        <div class="split-section">
          <h3>Navigation Fund / Forever Split</h3>
          <p style="color: var(--gray); font-size: 0.9375rem;">The Navigation Fund sustains you through the storm period. The Forever Half grows along the power law until withdrawals become negligible.</p>
          <div class="split-slider-row">
            <span class="split-label">Fund: <strong id="v2-split-bridge-value">50</strong>%</span>
            <input type="range" id="v2-bridge-split" min="10" max="90" step="5" value="50">
            <span class="split-label">Forever: <strong id="v2-split-forever-value">50</strong>%</span>
          </div>
        </div>

        <!-- ── Freedom Now Inputs ──────────────────────── -->
        <div id="v2-freedom-inputs">
          <h3>Living Expenses</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="v2-annual-burn">Annual Burn Rate (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-annual-burn" value="50000" min="1000" step="1000">
            </div>

            <div class="input-group">
              <label for="v2-retirement-year">Retirement Start Year</label>
              <div class="year-input-row">
                <input type="number" id="v2-retirement-year" value="2030" min="2024" max="2060" step="1">
                <button type="button" class="now-btn" id="v2-start-now-btn" title="Start retirement this year">Now</button>
              </div>
            </div>

            <div class="input-group">
              <label for="v2-spending-growth">Annual Spending Growth (%)</label>
              <input type="range" id="v2-spending-growth" min="0" max="12" step="0.5" value="6.5">
              <div class="slider-value"><span id="v2-spending-growth-value">6.5</span>%</div>
            </div>

            <div class="input-group">
              <label for="v2-swr-normal">Base Withdrawal Rate (%)</label>
              <input type="range" id="v2-swr-normal" min="1" max="8" step="0.5" value="4">
              <div class="slider-value"><span id="v2-swr-value">4</span>%</div>
            </div>

            <div class="input-group">
              <label>Forever Half SWR</label>
              <div class="slider-value" id="v2-forever-swr-display" style="font-size: 1.125rem;">—</div>
              <div style="color: var(--gray); font-size: 0.8rem;">25% &times; expected return for retirement year</div>
            </div>
          </div>
        </div>

        <!-- ── End Result Inputs ───────────────────────── -->
        <div id="v2-endresult-inputs" class="hidden">
          <h3>Stacking Plan</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="v2-additional-years">Years of Continued Stacking</label>
              <input type="number" id="v2-additional-years" value="5" min="1" max="30" step="1">
            </div>

            <div class="input-group">
              <label for="v2-monthly-dca">Monthly DCA Amount (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-monthly-dca" value="500" min="50" step="50">
            </div>

            <div class="input-group">
              <label for="v2-income-growth">Annual Income Growth (%)</label>
              <input type="range" id="v2-income-growth" min="0" max="10" step="0.5" value="3">
              <div class="slider-value"><span id="v2-income-growth-value">3</span>%</div>
            </div>

            <div class="input-group">
              <label for="v2-annual-burn-er">Annual Burn at Retirement (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-annual-burn-er" value="50000" min="1000" step="1000">
            </div>
          </div>
        </div>

        <button class="calculate-btn" id="v2-calculate-btn">Calculate Retirement Plan</button>
        <button class="calculate-btn secondary" id="v2-compare-btn">Compare All Scenarios</button>

        <!-- Action buttons (shown after calculation) -->
        <div class="action-buttons hidden" id="v2-action-buttons">
          <button class="calculate-btn secondary" id="v2-sidebyside-btn">Side-by-Side Comparison</button>
          <button class="calculate-btn secondary" id="v2-montecarlo-btn">Monte Carlo Analysis</button>
          <button class="calculate-btn secondary" id="v2-export-pdf-btn">Save as PDF</button>
          <button class="calculate-btn secondary" id="v2-reset-btn">Reset Defaults</button>
        </div>

        <!-- Status Banner -->
        <div id="v2-status-banner" class="status-banner hidden">
          <div class="status-icon" id="v2-status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="v2-status-headline"></div>
            <div class="status-detail" id="v2-status-detail"></div>
          </div>
        </div>
      </div>

      <!-- ── Storm Period Section ──────────────────────── -->
      <section id="v2-storm-section" class="hidden">
        <h2>The Storm Period</h2>
        <div id="v2-storm-content"></div>
      </section>

      <!-- ── Accumulation Chart (End Result) ───────────── -->
      <section id="v2-accum-chart-section" class="hidden">
        <h2>Accumulation Phase</h2>
        <p>Your BTC stack grows during the stacking years through monthly DCA purchases.</p>
        <div class="chart-container" style="position: relative; height: 350px;">
          <canvas id="v2-accum-chart" aria-label="BTC accumulation over time"></canvas>
        </div>
      </section>

      <!-- ── Navigation Fund Chart ─────────────────────── -->
      <section id="v2-bridge-chart-section" class="hidden">
        <h2>Navigation Fund Projection</h2>
        <p>Your active capital: withdrawals and the tactical fight to survive the storm.</p>
        <div class="chart-container" style="position: relative; height: 450px;">
          <canvas id="v2-bridge-chart" aria-label="Navigation Fund projection over time"></canvas>
        </div>
      </section>

      <!-- ── Forever Half Chart ────────────────────────── -->
      <section id="v2-forever-chart-section" class="hidden">
        <h2>Forever Half Projection</h2>
        <p>Your reserved capital: growing along the power law curve until your burn rate becomes a rounding error.</p>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="v2-forever-chart" aria-label="Forever half value vs annual burn"></canvas>
        </div>
      </section>

      <!-- ── Summary Cards ─────────────────────────────── -->
      <section id="v2-results-section" class="hidden">
        <h2>Retirement Summary</h2>
        <div class="dashboard" id="v2-summary-cards"></div>
      </section>

      <!-- ── Comparison Section ────────────────────────── -->
      <section id="v2-comparison-section" class="hidden">
        <h2>Scenario Comparison</h2>
        <p>How your Navigation Fund / Forever Half plan holds up across different price scenarios.</p>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Storm Period</th>
                <th>Fund Survives</th>
                <th>Minimum BTC</th>
                <th>Avg SWR</th>
              </tr>
            </thead>
            <tbody id="v2-comparison-body"></tbody>
          </table>
        </div>
      </section>

      <!-- ── Year-by-Year Table ────────────────────────── -->
      <section id="v2-table-section" class="hidden">
        <h2>Year-by-Year Breakdown</h2>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Year</th>
                  <th>BTC Price</th>
                  <th>Multiple</th>
                  <th>SWR</th>
                  <th>Withdrawal</th>
                  <th>BTC Sold</th>
                  <th>Fund BTC</th>
                  <th>Fund Value</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="v2-yearly-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Key Insight ───────────────────────────────── -->
      <section id="v2-insight-section" class="hidden">
        <div class="info-box">
          <h4>The Storm Navigation Insight</h4>
          <p id="v2-insight-text"></p>
        </div>
      </section>

      <!-- ── Side-by-Side Comparison ────────────────────── -->
      <section id="v2-sidebyside-section" class="hidden">
        <h2>Freedom Now vs. End Result</h2>
        <p>Compare retiring today with stacking for a few more years.</p>
        <div id="v2-sidebyside-content"></div>
      </section>

      <!-- ── Monte Carlo Analysis ──────────────────────── -->
      <section id="v2-montecarlo-section" class="hidden">
        <h2>Monte Carlo Analysis</h2>
        <p>200 random price simulations around the power law trend. How often does your Navigation Fund survive the storm?</p>
        <div id="v2-montecarlo-summary" style="margin-bottom: var(--spacing-md);"></div>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="v2-montecarlo-chart" aria-label="Monte Carlo Navigation Fund survival confidence bands"></canvas>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodology</h4>
          <p>Navigation Fund: active decumulation with dynamic withdrawal rate (adjusts 1%–6% based on price vs. power law trend). Forever Half: passive growth along power law curve. Storm period: years until burn &lt; Forever SWR (25% &times; expected return).</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Not financial advice. For educational purposes only.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Historical model fit does not guarantee future performance. Always do your own research.</p>
      </div>
    </div>
  </footer>

  <!-- Page-specific styles -->
  <style>
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .hidden { display: none; }

    /* Mode Toggle */
    .mode-toggle {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: var(--spacing-xl);
      border: 2px solid var(--black);
      border-radius: var(--border-radius);
      overflow: hidden;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .mode-toggle .toggle-btn {
      flex: 1;
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      background: var(--white);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      color: var(--gray);
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-toggle .toggle-btn.active {
      background: var(--black);
      color: var(--white);
    }

    .mode-toggle .toggle-btn:not(.active):hover {
      background: var(--gray-light);
    }

    /* Input Grid */
    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .slider-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--orange);
      text-align: center;
    }

    /* Split Slider */
    .split-section {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--gray-border);
    }

    .split-slider-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-md);
    }

    .split-slider-row input[type="range"] {
      flex: 1;
    }

    .split-label {
      font-size: 0.9375rem;
      font-weight: 500;
      white-space: nowrap;
      min-width: 110px;
    }

    .split-label:last-child {
      text-align: right;
    }

    /* Buttons */
    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    .year-input-row {
      display: flex;
      gap: var(--spacing-xs);
      align-items: stretch;
    }

    .year-input-row input {
      flex: 1;
      min-width: 0;
    }

    .now-btn {
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--orange);
      border-radius: var(--border-radius);
      background: rgba(247, 147, 26, 0.08);
      color: var(--orange);
      font-family: var(--font-family);
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .now-btn:hover {
      background: var(--orange);
      color: var(--white);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-banner.status-red {
      background: rgba(255, 23, 68, 0.08);
      border-left-color: var(--red);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content { flex: 1; min-width: 0; }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    /* Storm Period */
    .storm-summary {
      background: var(--gray-light);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
    }

    .storm-metrics-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--spacing-md);
    }

    .storm-metric {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .storm-label {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .storm-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--black);
    }

    /* Table statuses */
    .status-ok { color: var(--green); }
    .status-ruin { color: var(--red); font-weight: 700; }
    .status-sell { color: var(--gray); }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons, .mode-toggle,
      #v2-input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }

    @media (max-width: 768px) {
      .split-slider-row {
        flex-direction: column;
        align-items: stretch;
      }
      .split-label:last-child {
        text-align: left;
      }
      .mode-toggle {
        max-width: 100%;
      }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/powerlaw.js"></script>
  <script src="../js/retirement.js"></script>
  <script src="../js/retirement-v2.js"></script>
  <script src="../js/retirement-v2-ui.js"></script>
</body>
</html>
