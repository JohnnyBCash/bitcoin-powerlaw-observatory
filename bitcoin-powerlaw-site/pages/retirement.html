<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retirement Calculator - Bitcoin Power Law Observatory</title>
  <meta name="description" content="Plan retirement on a Bitcoin standard using power law projections with optional bitcoin-backed loans.">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Power Law Observatory
      </a>
      <nav class="nav" aria-label="Main navigation">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">History</a>
        <a href="future.html">Future</a>
        <a href="dca.html">DCA</a>
        <a href="equity.html">Equity</a>
        <a href="retirement.html" class="active">Retirement</a>
        <a href="about.html">About</a>
      </nav>
      <div class="lang-toggle">
        <a href="retirement.html" class="lang-link active">EN</a>
        <span class="lang-sep">|</span>
        <a href="../nl/pages/retirement.html" class="lang-link">NL</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Bitcoin Retirement Calculator</h1>
        <p>How much bitcoin do you need to retire? Explore the math behind withdrawing from a power law asset, with or without bitcoin-backed loans.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Important:</strong> This is an educational tool based on power law models, not financial advice. The model assumes the power law continues to hold. Real outcomes will vary. Always do your own research and consult professionals.</p>
      </div>

      <!-- ── Input Section ──────────────────────────────── -->
      <div class="card" id="input-section">
        <h3>Your Parameters</h3>

        <div class="input-grid">
          <div class="input-group">
            <label for="btc-holdings">Bitcoin Holdings (BTC)</label>
            <input type="number" id="btc-holdings" value="1.0" min="0.01" step="0.01">
          </div>

          <div class="input-group">
            <label for="currency">Currency</label>
            <select id="currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">€ EUR</option>
            </select>
          </div>

          <div class="input-group">
            <label for="annual-spend">Annual Spending (<span id="currency-label">USD</span>)</label>
            <input type="number" id="annual-spend" value="50000" min="1000" step="1000">
          </div>

          <div class="input-group">
            <label for="retirement-year">Retirement Start Year</label>
            <div class="year-input-row">
              <input type="number" id="retirement-year" value="2030" min="2024" max="2060" step="1">
              <button type="button" class="now-btn" id="start-now-btn" title="Start retirement this year">Now</button>
            </div>
          </div>

          <div class="input-group">
            <label for="time-horizon">Time Horizon (years)</label>
            <input type="number" id="time-horizon" value="30" min="5" max="50" step="1">
          </div>

          <div class="input-group">
            <label for="m2-growth">Annual Spending Growth (%)</label>
            <input type="range" id="m2-growth" min="0" max="12" step="0.5" value="6.5">
            <div class="slider-value"><span id="m2-value">6.5</span>%</div>
            <div class="spending-growth-hint hidden" id="spending-growth-hint">0% means fixed spending — your purchasing power will decline over time as prices rise</div>
          </div>

          <div class="input-group">
            <label for="price-scenario">Price Scenario</label>
            <select id="price-scenario">
              <option value="cyclical" selected>Cyclical (±1σ, lengthening periods)</option>
              <option value="cyclical_bear">Bear Bias Cycles (60% below trend)</option>
              <option value="smooth_trend">Smooth Trend (flat on trend)</option>
              <option value="smooth_bear">Bear (flat −1σ below trend)</option>
              <option value="smooth_deep_bear">Deep Bear (flat −2σ below trend)</option>
            </select>
          </div>
        </div>

        <!-- ── Loans Toggle ──────────────────────────────── -->
        <div class="loans-toggle-section">
          <h3>Bitcoin-Backed Loans</h3>
          <p style="color: var(--gray); font-size: 0.9375rem;">When bitcoin is below the trend line, borrow against your stack instead of selling at unfavorable prices. This preserves your BTC but adds interest cost and liquidation risk.</p>

          <div class="toggle-switch-row">
            <label class="toggle-switch">
              <input type="checkbox" id="use-loans">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label" id="loans-label">Loans: OFF — Sell only</span>
          </div>

          <div id="loan-params" class="loan-params hidden">
            <div class="input-grid">
              <div class="input-group">
                <label for="loan-ltv">Loan-to-Value (%)</label>
                <input type="range" id="loan-ltv" min="20" max="50" step="5" value="40">
                <div class="slider-value"><span id="ltv-value">40</span>%</div>
              </div>

              <div class="input-group">
                <label for="loan-interest">Annual Interest Rate (%)</label>
                <input type="range" id="loan-interest" min="3" max="15" step="0.5" value="8">
                <div class="slider-value"><span id="interest-value">8</span>%</div>
              </div>

              <div class="input-group">
                <label for="loan-threshold">Borrow when price/trend below</label>
                <input type="range" id="loan-threshold" min="0.5" max="1.5" step="0.1" value="1.0">
                <div class="slider-value"><span id="threshold-value">1.0</span>×</div>
              </div>
            </div>
          </div>
        </div>

        <button class="calculate-btn" id="calculate-btn">Calculate Retirement Plan</button>
        <button class="calculate-btn secondary" id="compare-btn">Compare: Loans vs No Loans</button>

        <!-- Action buttons — shown after first calculation -->
        <div class="action-buttons hidden" id="action-buttons">
          <button class="calculate-btn secondary" id="export-pdf-btn">&#128196; Save as PDF</button>
          <button class="calculate-btn secondary" id="reset-defaults-btn">&#8634; Reset Defaults</button>
        </div>

        <!-- Status Banner - appears in-place after calculation -->
        <div id="status-banner" class="status-banner hidden">
          <div class="status-icon" id="status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="status-headline"></div>
            <div class="status-detail" id="status-detail"></div>
          </div>
        </div>
      </div>


      <!-- ── CAGR Decay Section ─────────────────────────── -->
      <section id="cagr-section" class="hidden">
        <h2>Expected Return Decay</h2>
        <p>Power law assets have decreasing annual returns over time. Unlike exponential growth (constant CAGR), the power law's CAGR declines — which fundamentally changes retirement math.</p>
        <div class="chart-container" style="position: relative; height: 350px;">
          <canvas id="cagr-chart" aria-label="CAGR decay over time"></canvas>
        </div>
      </section>

      <!-- ── Summary Cards ──────────────────────────────── -->
      <section id="results-section" class="hidden">
        <h2>Retirement Summary</h2>
        <div class="dashboard" id="summary-cards">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- ── Comparison Section ─────────────────────────── -->
      <section id="comparison-section" class="hidden">
        <h2>Loans vs Sell-Only: Required Stack</h2>
        <p>How much bitcoin you need to survive your full retirement horizon under each scenario.</p>
        <div class="table-container">
          <table id="comparison-table">
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Sell Only (BTC needed)</th>
                <th>With Loans (BTC needed)</th>
                <th>BTC Saved</th>
                <th>Savings %</th>
                <th>Total Interest Paid</th>
              </tr>
            </thead>
            <tbody id="comparison-body">
            </tbody>
          </table>
        </div>
      </section>


      <!-- ── Stack Over Time Chart ──────────────────────── -->
      <section id="stack-chart-section" class="hidden">
        <h2>Stack & Spending Over Time</h2>
        <div class="chart-container" style="position: relative; height: 450px;">
          <canvas id="stack-chart" aria-label="BTC stack and spending over time"></canvas>
        </div>
      </section>

      <!-- ── Year-by-Year Table ─────────────────────────── -->
      <section id="table-section" class="hidden">
        <h2>Year-by-Year Breakdown</h2>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Year</th>
                  <th>BTC Price</th>
                  <th>Trend</th>
                  <th>Multiple</th>
                  <th>Spending</th>
                  <th>BTC Sold</th>
                  <th>Loan Balance</th>
                  <th>Stack</th>
                  <th>Portfolio Value</th>
                  <th>SWR %</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="yearly-table-body">
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Key Insight ────────────────────────────────── -->
      <section id="insight-section" class="hidden">
        <div class="info-box">
          <h4>Why This Matters</h4>
          <p id="insight-text"></p>
        </div>
      </section>

    </div>
  </main>


  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodology</h4>
          <p>Power law trend: expected growth path. M2 growth: real inflation proxy. Loans: borrow below trend to preserve stack. SWR: dynamic, decreasing with power law CAGR.</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Not financial advice. For educational purposes only.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Historical model fit does not guarantee future performance. Always do your own research.</p>
      </div>
    </div>
  </footer>

  <!-- Page-specific styles -->
  <style>
    /* Override global canvas height to respect container */
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    /* Ensure sections don't overlap */
    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .slider-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--orange);
      text-align: center;
    }

    .loans-toggle-section {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--gray-border);
    }

    .toggle-switch-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      flex-shrink: 0;
    }

    .toggle-switch input { display: none; }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: var(--gray-border);
      border-radius: 28px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      left: 3px;
      top: 3px;
      background: var(--white);
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: var(--orange);
    }

    .toggle-switch input:checked + .toggle-slider::before {
      transform: translateX(24px);
    }

    .toggle-label {
      font-weight: 500;
      font-size: 0.9375rem;
    }

    .loan-params {
      margin-top: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--gray-light);
      border-radius: var(--border-radius);
    }

    .hidden { display: none; }

    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    /* Status badges in table */
    .status-ok { color: var(--green); }
    .status-borrow { color: var(--orange); }
    .status-ruin { color: var(--red); font-weight: 700; }
    .status-sell { color: var(--gray); }

    .comparison-highlight {
      background: rgba(247, 147, 26, 0.08);
      font-weight: 600;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-banner.status-red {
      background: rgba(255, 23, 68, 0.08);
      border-left-color: var(--red);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content {
      flex: 1;
      min-width: 0;
    }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    .status-detail strong {
      color: var(--black);
    }

    .spending-growth-hint {
      font-size: 0.8125rem;
      color: var(--orange);
      margin-top: 2px;
      line-height: 1.4;
    }

    .year-input-row {
      display: flex;
      gap: var(--spacing-xs);
      align-items: stretch;
    }

    .year-input-row input {
      flex: 1;
      min-width: 0;
    }

    .now-btn {
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--orange);
      border-radius: var(--border-radius);
      background: rgba(247, 147, 26, 0.08);
      color: var(--orange);
      font-family: var(--font-family);
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .now-btn:hover {
      background: var(--orange);
      color: var(--white);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons, .loans-toggle-section,
      #input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }
  </style>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="../js/powerlaw.js"></script>
  <script src="../js/retirement.js"></script>
  <script src="../js/retirement-ui.js"></script>
</body>
</html>
