<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mortgage Calculator - Bitcoin Power Law Observatory</title>
  <meta name="description" content="Explore using a home equity loan to buy Bitcoin. See projected returns under power law price scenarios.">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Power Law Observatory
      </a>
      <nav class="nav" aria-label="Main navigation">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">History</a>
        <a href="future.html">Future</a>
        <a href="dca.html">DCA</a>
        <a href="equity.html" class="active">Mortgage</a>
        <a href="retirement.html">Retirement</a>
        <a href="about.html">About</a>
      </nav>
      <div class="lang-toggle">
        <a href="equity.html" class="lang-link active">EN</a>
        <span class="lang-sep">|</span>
        <a href="../nl/pages/equity.html" class="lang-link">NL</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Mortgage Bitcoin Calculator</h1>
        <p>What if you used a home equity loan to buy Bitcoin? Explore the projected outcome under different power law scenarios. See when your Bitcoin could break even against the loan cost.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Important:</strong> This is an educational tool based on power law models, not financial advice. Using home equity to buy Bitcoin carries significant risk. The model assumes the power law continues to hold. Real outcomes will vary. Always do your own research and consult a financial adviser.</p>
      </div>

      <!-- ── Input Section ──────────────────────────────── -->
      <div class="card" id="eq-input-section">

        <!-- Loan Parameters -->
        <h3>Loan Parameters</h3>
        <div class="input-grid">
          <div class="input-group">
            <label for="eq-loan-amount">Loan Amount (<span id="eq-currency-label">$</span>)</label>
            <input type="number" id="eq-loan-amount" value="50000" min="1000" step="1000">
          </div>
          <div class="input-group">
            <label for="eq-currency">Currency</label>
            <select id="eq-currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">&euro; EUR</option>
            </select>
          </div>
          <div class="input-group">
            <label for="eq-duration">Loan Duration (years)</label>
            <input type="number" id="eq-duration" value="10" min="1" max="30">
          </div>
          <div class="input-group">
            <label for="eq-interest-rate">Interest Rate</label>
            <input type="range" id="eq-interest-rate" min="3" max="6" step="0.1" value="4.5">
            <div class="slider-value"><span id="eq-interest-value">4.5</span>%</div>
          </div>
        </div>

        <!-- Interest-only toggle -->
        <div class="toggle-switch-row" style="margin-top: var(--spacing-sm);">
          <label class="toggle-switch">
            <input type="checkbox" id="eq-interest-only">
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-label" id="eq-interest-only-label">Interest-only (aflossingsvrij): OFF</span>
        </div>

        <!-- Home & Mortgage -->
        <div class="loans-toggle-section">
          <h3>Home &amp; Mortgage</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="eq-home-value">Home Value (<span id="eq-currency-label2">$</span>)</label>
              <input type="number" id="eq-home-value" value="500000" min="0" step="10000">
            </div>
            <div class="input-group">
              <label for="eq-mortgage-balance">Current Mortgage Balance (<span id="eq-currency-label3">$</span>)</label>
              <input type="number" id="eq-mortgage-balance" value="300000" min="0" step="10000">
            </div>
            <div class="input-group">
              <label for="eq-mortgage-rate">Mortgage Rate</label>
              <input type="range" id="eq-mortgage-rate" min="1" max="6" step="0.1" value="3.5">
              <div class="slider-value"><span id="eq-mortgage-rate-value">3.5</span>%</div>
            </div>
          </div>

          <!-- Auto-calculated equity display -->
          <div class="loan-params" style="margin-top: var(--spacing-md); display: flex; gap: var(--spacing-xl); flex-wrap: wrap;">
            <div>
              <div class="equity-label">Home Equity</div>
              <div class="equity-value" id="eq-home-equity">--</div>
            </div>
            <div>
              <div class="equity-label">Existing LTV</div>
              <div class="equity-value" id="eq-existing-ltv">--</div>
            </div>
            <div>
              <div class="equity-label">Total LTV (with new loan)</div>
              <div class="equity-value" id="eq-total-ltv">--</div>
            </div>
          </div>
          <div id="eq-ltv-warning" class="hidden" style="color: var(--red); font-size: 0.875rem; font-weight: 500; margin-top: var(--spacing-xs);">
            &#9888; Total LTV exceeds 80%. Lenders typically require mortgage insurance or may decline the loan.
          </div>
        </div>

        <!-- Bitcoin Purchase Timing -->
        <div class="loans-toggle-section">
          <h3>Bitcoin Purchase</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="eq-buy-timing">When to Buy</label>
              <select id="eq-buy-timing">
                <option value="now" selected>Buy now at current price</option>
                <option value="future">Future purchase (estimate)</option>
              </select>
            </div>
            <div class="input-group">
              <label>Current BTC Price</label>
              <div id="eq-live-price" style="font-size: 1.1rem; font-weight: 600; padding-top: 0.3rem;">Loading...</div>
            </div>
          </div>

          <!-- Future date picker (hidden by default) -->
          <div id="eq-future-date-section" class="hidden" style="margin-top: var(--spacing-md);">
            <div class="input-grid">
              <div class="input-group">
                <label for="eq-future-year">Purchase Year</label>
                <input type="number" id="eq-future-year" value="2026" min="2025" max="2040">
              </div>
              <div class="input-group">
                <label for="eq-future-month">Purchase Month</label>
                <select id="eq-future-month">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6" selected>June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
              <div class="input-group">
                <label>Projected BTC Price</label>
                <div id="eq-future-price" style="font-size: 1.1rem; font-weight: 600; padding-top: 0.3rem;">--</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scenario -->
        <div class="loans-toggle-section">
          <h3>Price Scenario</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="eq-scenario">Scenario</label>
              <select id="eq-scenario">
                <option value="cyclical" selected>Cyclical (&plusmn;1&sigma;, lengthening periods)</option>
                <option value="cyclical_bear">Bear Bias Cycles (60% below trend)</option>
                <option value="smooth_trend">Smooth Trend (stays on trend)</option>
                <option value="smooth_bear">Bear (flat &minus;1&sigma; below trend)</option>
                <option value="smooth_deep_bear">Deep Bear (flat &minus;2&sigma; below trend)</option>
              </select>
            </div>
          </div>
        </div>

        <button class="calculate-btn" id="eq-calculate-btn">Calculate Mortgage Plan</button>
        <button class="calculate-btn secondary" id="eq-compare-btn">Compare All Scenarios</button>

        <!-- Action buttons — shown after first calculation -->
        <div class="action-buttons hidden" id="eq-action-buttons">
          <button class="calculate-btn secondary" id="eq-export-pdf-btn">&#128196; Save as PDF</button>
          <button class="calculate-btn secondary" id="eq-reset-btn">&#8634; Reset Defaults</button>
        </div>

        <!-- Status Banner -->
        <div id="eq-status-banner" class="status-banner hidden">
          <div class="status-icon" id="eq-status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="eq-status-headline"></div>
            <div class="status-detail" id="eq-status-detail"></div>
          </div>
        </div>
      </div>

      <!-- ── Summary Cards ──────────────────────────────── -->
      <section id="eq-results-section" class="hidden">
        <h2>Mortgage Loan Summary</h2>
        <div class="dashboard" id="eq-summary-cards">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- ── Value Chart ────────────────────────────────── -->
      <section id="eq-chart-section" class="hidden">
        <h2>Bitcoin Value vs Loan Cost</h2>
        <p>The green line is your Bitcoin's projected value. The orange line is your cumulative loan cost. Where green crosses above orange is your break-even point.</p>
        <div class="chart-container" style="position: relative; height: 420px;">
          <canvas id="eq-value-chart" aria-label="Bitcoin value versus loan cost over time"></canvas>
        </div>
      </section>

      <!-- ── Year-by-Year Table ─────────────────────────── -->
      <section id="eq-table-section" class="hidden">
        <h2>Year-by-Year Breakdown</h2>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Year</th>
                  <th>BTC Price</th>
                  <th>BTC Value</th>
                  <th>Annual Cost</th>
                  <th>Cumulative Cost</th>
                  <th>Loan Balance</th>
                  <th>Net Position</th>
                  <th>LTV</th>
                  <th>ROI</th>
                </tr>
              </thead>
              <tbody id="eq-yearly-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Scenario Comparison ────────────────────────── -->
      <section id="eq-comparison-section" class="hidden">
        <h2>Scenario Comparison</h2>
        <p>How the equity loan performs under each price scenario.</p>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Final BTC Value</th>
                <th>Total Cost</th>
                <th>Net Gain/Loss</th>
                <th>ROI</th>
                <th>Break-Even</th>
              </tr>
            </thead>
            <tbody id="eq-comparison-body"></tbody>
          </table>
        </div>
      </section>

      <!-- ── Key Insight ────────────────────────────────── -->
      <section id="eq-insight-section" class="hidden">
        <div class="info-box">
          <h4>Key Insight</h4>
          <p id="eq-insight-text"></p>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodology</h4>
          <p>Power law trend: expected growth path. Scenario engine models cyclical deviation around trend. Loan amortisation follows standard annuity or interest-only schedules.</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Not financial advice. For educational purposes only.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>This is not financial advice. Using home equity to invest in Bitcoin carries significant risk. Historical model fit does not guarantee future performance.</p>
      </div>
    </div>
  </footer>

  <!-- Page-specific styles -->
  <style>
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .slider-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--orange);
      text-align: center;
    }

    .loans-toggle-section {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--gray-border);
    }

    .toggle-switch-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      flex-shrink: 0;
    }

    .toggle-switch input { display: none; }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: var(--gray-border);
      border-radius: 28px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      left: 3px;
      top: 3px;
      background: var(--white);
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: var(--orange);
    }

    .toggle-switch input:checked + .toggle-slider::before {
      transform: translateX(24px);
    }

    .toggle-label {
      font-weight: 500;
      font-size: 0.9375rem;
    }

    .loan-params {
      padding: var(--spacing-md);
      background: var(--gray-light);
      border-radius: var(--border-radius);
    }

    .equity-label {
      font-size: 0.75rem;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .equity-value {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .hidden { display: none; }

    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-banner.status-red {
      background: rgba(255, 23, 68, 0.08);
      border-left-color: var(--red);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content {
      flex: 1;
      min-width: 0;
    }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    .status-detail strong {
      color: var(--black);
    }

    .roi-positive { color: var(--green); font-weight: 600; }
    .roi-negative { color: var(--red); font-weight: 600; }

    .comparison-winner {
      background: rgba(0, 200, 83, 0.08);
      font-weight: 600;
    }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons,
      #eq-input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="../js/powerlaw.js"></script>
  <script src="../js/retirement.js"></script>
  <script src="../js/equity.js"></script>
  <script src="../js/equity-ui.js"></script>
</body>
</html>
