<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DCA Calculator - Bitcoin Power Law Observatory</title>
  <meta name="description" content="Simulate dollar-cost averaging and lump sum Bitcoin purchases using power law price projections. See your stack and portfolio grow over time.">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Power Law Observatory
      </a>
      <nav class="nav" aria-label="Main navigation">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">History</a>
        <a href="price-chart.html">Price Chart</a>
        <a href="future.html">Future</a>
        <a href="retirement.html">Retirement</a>
        <a href="dca.html" class="active">DCA</a>
        <a href="about.html">About</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>DCA Calculator</h1>
        <p>What happens when you buy Bitcoin &mdash; as a lump sum, a monthly DCA, or both? See how your stack and portfolio value grow under power law projections.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Important:</strong> This is an educational tool based on power law models, not financial advice. The model assumes the power law continues to hold. Real outcomes will vary. Always do your own research.</p>
      </div>

      <!-- ── Input Section ──────────────────────────────── -->
      <div class="card" id="dca-input-section">
        <h3>Your DCA Parameters</h3>

        <div class="input-grid">
          <div class="input-group">
            <label for="dca-lump-sum">Lump Sum (<span id="dca-currency-label">USD</span>)</label>
            <input type="number" id="dca-lump-sum" value="10000" min="0" step="100">
            <span class="input-hint">One-time initial purchase (0 = none)</span>
          </div>

          <div class="input-group">
            <label for="dca-monthly">Monthly DCA (<span id="dca-currency-label2">USD</span>)</label>
            <input type="number" id="dca-monthly" value="500" min="0" step="50">
            <span class="input-hint">Recurring monthly buy (0 = none)</span>
          </div>

          <div class="input-group">
            <label for="dca-currency">Currency</label>
            <select id="dca-currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">&euro; EUR</option>
            </select>
          </div>

          <div class="input-group">
            <label for="dca-start-year">Start Year</label>
            <div class="year-input-row">
              <input type="number" id="dca-start-year" value="2025" min="2024" max="2060" step="1">
              <button type="button" class="now-btn" id="dca-start-now-btn" title="Start this year">Now</button>
            </div>
          </div>

          <div class="input-group">
            <label for="dca-start-month">Start Month</label>
            <select id="dca-start-month">
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>

          <div class="input-group">
            <label for="dca-horizon">Time Horizon (years)</label>
            <input type="number" id="dca-horizon" value="10" min="1" max="30" step="1">
          </div>

          <div class="input-group">
            <label for="dca-scenario">Price Scenario</label>
            <select id="dca-scenario">
              <option value="cyclical" selected>Cyclical (&plusmn;1&sigma;, lengthening periods)</option>
              <option value="cyclical_bear">Bear Bias Cycles (60% below trend)</option>
              <option value="smooth_trend">Smooth Trend (flat on trend)</option>
              <option value="smooth_bear">Bear (flat &minus;1&sigma; below trend)</option>
              <option value="smooth_deep_bear">Deep Bear (flat &minus;2&sigma; below trend)</option>
            </select>
          </div>
        </div>

        <button class="calculate-btn" id="dca-calculate-btn">Calculate DCA</button>
        <button class="calculate-btn secondary" id="dca-compare-btn">Compare: Lump Sum vs DCA vs Combined</button>

        <!-- Action buttons — shown after first calculation -->
        <div class="action-buttons hidden" id="dca-action-buttons">
          <button class="calculate-btn secondary" id="dca-export-pdf-btn">&#128196; Save as PDF</button>
          <button class="calculate-btn secondary" id="dca-reset-btn">&#8634; Reset Defaults</button>
        </div>

        <!-- Status Banner -->
        <div id="dca-status-banner" class="status-banner hidden">
          <div class="status-icon" id="dca-status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="dca-status-headline"></div>
            <div class="status-detail" id="dca-status-detail"></div>
          </div>
        </div>
      </div>

      <!-- ── Summary Cards ──────────────────────────────── -->
      <section id="dca-results-section" class="hidden">
        <h2>DCA Summary</h2>
        <div class="dashboard" id="dca-summary-cards">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- ── Growth Chart: Portfolio Value vs Invested ──── -->
      <section id="dca-growth-section" class="hidden">
        <h2>Portfolio Value vs Total Invested</h2>
        <p>The green area above the orange line represents your unrealised gains.</p>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="dca-growth-chart" aria-label="Portfolio value vs total invested over time"></canvas>
        </div>
      </section>

      <!-- ── Accumulation Chart: BTC Stack ──────────────── -->
      <section id="dca-accumulation-section" class="hidden">
        <h2>Bitcoin Accumulation</h2>
        <p>Your BTC stack growing month by month.</p>
        <div class="chart-container" style="position: relative; height: 350px;">
          <canvas id="dca-accumulation-chart" aria-label="BTC accumulation over time"></canvas>
        </div>
      </section>

      <!-- ── Comparison Section ─────────────────────────── -->
      <section id="dca-comparison-section" class="hidden">
        <h2>Strategy Comparison</h2>
        <p>Lump sum only vs monthly DCA only vs combined approach.</p>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="dca-comparison-chart" aria-label="Strategy comparison chart"></canvas>
        </div>
        <div class="table-container" style="margin-top: var(--spacing-lg);">
          <table>
            <thead>
              <tr>
                <th>Strategy</th>
                <th>Total Invested</th>
                <th>BTC Accumulated</th>
                <th>Final Value</th>
                <th>Gain / Loss</th>
                <th>ROI %</th>
                <th>Avg Cost Basis</th>
              </tr>
            </thead>
            <tbody id="dca-comparison-body"></tbody>
          </table>
        </div>
      </section>

      <!-- ── Monthly Table ──────────────────────────────── -->
      <section id="dca-table-section" class="hidden">
        <h2>Month-by-Month Breakdown</h2>
        <button class="calculate-btn secondary" id="dca-table-toggle-btn" style="margin-bottom: var(--spacing-md); margin-top:0;">Show All Months</button>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>BTC Price</th>
                  <th>Monthly Buy</th>
                  <th>BTC Bought</th>
                  <th>Cumulative BTC</th>
                  <th>Total Invested</th>
                  <th>Portfolio Value</th>
                  <th>ROI %</th>
                </tr>
              </thead>
              <tbody id="dca-monthly-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Insight ────────────────────────────────────── -->
      <section id="dca-insight-section" class="hidden">
        <div class="info-box">
          <h4>DCA Insight</h4>
          <p id="dca-insight-text"></p>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodology</h4>
          <p>Power law trend: expected growth path. Scenario engine models cyclical deviation around trend. Dollar-cost averaging buys at each month's scenario price.</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Not financial advice. For educational purposes only.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Historical model fit does not guarantee future performance. Always do your own research.</p>
      </div>
    </div>
  </footer>

  <!-- Page-specific styles -->
  <style>
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .input-hint {
      font-size: 0.8125rem;
      color: var(--gray);
      margin-top: 2px;
    }

    .hidden { display: none; }

    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    .year-input-row {
      display: flex;
      gap: var(--spacing-xs);
      align-items: stretch;
    }

    .year-input-row input {
      flex: 1;
      min-width: 0;
    }

    .now-btn {
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--orange);
      border-radius: var(--border-radius);
      background: rgba(247, 147, 26, 0.08);
      color: var(--orange);
      font-family: var(--font-family);
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .now-btn:hover {
      background: var(--orange);
      color: var(--white);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content {
      flex: 1;
      min-width: 0;
    }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    .status-detail strong {
      color: var(--black);
    }

    .roi-positive { color: var(--green); font-weight: 600; }
    .roi-negative { color: var(--red); font-weight: 600; }

    .comparison-winner {
      background: rgba(0, 200, 83, 0.08);
      font-weight: 600;
    }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons,
      #dca-input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="../js/powerlaw.js"></script>
  <script src="../js/retirement.js"></script>
  <script src="../js/dca.js"></script>
  <script src="../js/dca-ui.js"></script>
</body>
</html>
