<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pensioenrekentool - Bitcoin Machtswet Observatorium</title>
  <meta name="description" content="Plan je pensioen op een Bitcoin-standaard met machtswetprojecties en optionele bitcoin-gedekte leningen.">
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Machtswet Observatorium
      </a>
      <nav class="nav" aria-label="Hoofdnavigatie">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">Geschiedenis</a>
        <a href="future.html">Toekomst</a>
        <a href="dca.html">DCA</a>
        <a href="equity.html">Overwaarde</a>
        <a href="retirement.html" class="active">Pensioen</a>
        <a href="about.html">Over</a>
      </nav>
      <div class="lang-toggle">
        <a href="../../pages/retirement.html" class="lang-link">EN</a>
        <span class="lang-sep">|</span>
        <a href="retirement.html" class="lang-link active">NL</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Bitcoin Pensioenrekentool</h1>
        <p>Hoeveel bitcoin heb je nodig om met pensioen te gaan? Ontdek de wiskunde achter het opnemen van een machtswet-asset, met of zonder bitcoin-gedekte leningen.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Belangrijk:</strong> Dit is een educatief hulpmiddel gebaseerd op machtswetwetmodellen, geen financieel advies. Het model gaat ervan uit dat de machtswet blijft gelden. Werkelijke resultaten zullen afwijken. Doe altijd je eigen onderzoek en raadpleeg professionals.</p>
      </div>

      <!-- ── Invoer Sectie ──────────────────────────────── -->
      <div class="card" id="input-section">
        <h3>Jouw Parameters</h3>

        <div class="input-grid">
          <div class="input-group">
            <label for="btc-holdings">Bitcoin Bezit (BTC)</label>
            <input type="number" id="btc-holdings" value="1.0" min="0.01" step="0.01">
          </div>

          <div class="input-group">
            <label for="currency">Valuta</label>
            <select id="currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">&euro; EUR</option>
            </select>
          </div>

          <div class="input-group">
            <label for="annual-spend">Jaarlijkse Uitgaven (<span id="currency-label">USD</span>)</label>
            <input type="number" id="annual-spend" value="50000" min="1000" step="1000">
          </div>

          <div class="input-group">
            <label for="retirement-year">Startjaar Pensioen</label>
            <div class="year-input-row">
              <input type="number" id="retirement-year" value="2030" min="2024" max="2060" step="1">
              <button type="button" class="now-btn" id="start-now-btn" title="Start pensioen dit jaar">Nu</button>
            </div>
          </div>

          <div class="input-group">
            <label for="time-horizon">Tijdshorizon (jaren)</label>
            <input type="number" id="time-horizon" value="30" min="5" max="50" step="1">
          </div>

          <div class="input-group">
            <label for="m2-growth">Jaarlijkse Uitgavengroei (%)</label>
            <input type="range" id="m2-growth" min="0" max="12" step="0.5" value="6.5">
            <div class="slider-value"><span id="m2-value">6.5</span>%</div>
            <div class="spending-growth-hint hidden" id="spending-growth-hint">0% betekent vaste uitgaven — je koopkracht daalt na verloop van tijd naarmate prijzen stijgen</div>
          </div>

          <div class="input-group">
            <label for="price-scenario">Prijsscenario</label>
            <select id="price-scenario">
              <option value="cyclical" selected>Cyclisch (&plusmn;1&sigma;, verlengde periodes)</option>
              <option value="cyclical_bear">Bear Bias Cycli (60% onder trend)</option>
              <option value="smooth_trend">Vlakke Trend (op trendlijn)</option>
              <option value="smooth_bear">Bear (vlak &minus;1&sigma; onder trend)</option>
              <option value="smooth_deep_bear">Diepe Bear (vlak &minus;2&sigma; onder trend)</option>
            </select>
          </div>
        </div>

        <!-- ── Leningen Toggle ──────────────────────────────── -->
        <div class="loans-toggle-section">
          <h3>Bitcoin-Gedekte Leningen</h3>
          <p style="color: var(--gray); font-size: 0.9375rem;">Wanneer bitcoin onder de trendlijn staat, leen je tegen je stack in plaats van te verkopen tegen ongunstige prijzen. Dit behoudt je BTC maar brengt rentekosten en liquidatierisico met zich mee.</p>

          <div class="toggle-switch-row">
            <label class="toggle-switch">
              <input type="checkbox" id="use-loans">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label" id="loans-label">Leningen: UIT — Alleen verkopen</span>
          </div>

          <div id="loan-params" class="loan-params hidden">
            <div class="input-grid">
              <div class="input-group">
                <label for="loan-ltv">Lening-tot-Waarde (%)</label>
                <input type="range" id="loan-ltv" min="20" max="50" step="5" value="40">
                <div class="slider-value"><span id="ltv-value">40</span>%</div>
              </div>

              <div class="input-group">
                <label for="loan-interest">Jaarlijkse Rente (%)</label>
                <input type="range" id="loan-interest" min="3" max="15" step="0.5" value="8">
                <div class="slider-value"><span id="interest-value">8</span>%</div>
              </div>

              <div class="input-group">
                <label for="loan-threshold">Lenen wanneer prijs/trend onder</label>
                <input type="range" id="loan-threshold" min="0.5" max="1.5" step="0.1" value="1.0">
                <div class="slider-value"><span id="threshold-value">1.0</span>&times;</div>
              </div>
            </div>
          </div>
        </div>

        <button class="calculate-btn" id="calculate-btn">Bereken Pensioenplan</button>
        <button class="calculate-btn secondary" id="compare-btn">Vergelijk: Leningen vs Zonder Leningen</button>

        <!-- Actieknoppen — getoond na eerste berekening -->
        <div class="action-buttons hidden" id="action-buttons">
          <button class="calculate-btn secondary" id="export-pdf-btn">&#128196; Opslaan als PDF</button>
          <button class="calculate-btn secondary" id="reset-defaults-btn">&#8634; Standaardwaarden Herstellen</button>
        </div>

        <!-- Statusbanner - verschijnt na berekening -->
        <div id="status-banner" class="status-banner hidden">
          <div class="status-icon" id="status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="status-headline"></div>
            <div class="status-detail" id="status-detail"></div>
          </div>
        </div>
      </div>


      <!-- ── CAGR Verval Sectie ─────────────────────────── -->
      <section id="cagr-section" class="hidden">
        <h2>Verwacht Rendementverval</h2>
        <p>Machtswet-assets hebben afnemende jaarlijkse rendementen over tijd. In tegenstelling tot exponentiële groei (constante CAGR), daalt de CAGR van de machtswet — wat de pensioenberekening fundamenteel verandert.</p>
        <div class="chart-container" style="position: relative; height: 350px;">
          <canvas id="cagr-chart" aria-label="CAGR-verval over tijd"></canvas>
        </div>
      </section>

      <!-- ── Samenvattingskaarten ──────────────────────────────── -->
      <section id="results-section" class="hidden">
        <h2>Pensioen Samenvatting</h2>
        <div class="dashboard" id="summary-cards">
          <!-- Gevuld door JS -->
        </div>
      </section>

      <!-- ── Vergelijkingssectie ─────────────────────────── -->
      <section id="comparison-section" class="hidden">
        <h2>Leningen vs Alleen Verkopen: Benodigde Stack</h2>
        <p>Hoeveel bitcoin je nodig hebt om je volledige pensioenhorizon te overleven onder elk scenario.</p>
        <div class="table-container">
          <table id="comparison-table">
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Alleen Verkopen (BTC nodig)</th>
                <th>Met Leningen (BTC nodig)</th>
                <th>BTC Bespaard</th>
                <th>Besparing %</th>
                <th>Totaal Rente Betaald</th>
              </tr>
            </thead>
            <tbody id="comparison-body">
            </tbody>
          </table>
        </div>
      </section>


      <!-- ── Stack Over Tijd Grafiek ──────────────────────── -->
      <section id="stack-chart-section" class="hidden">
        <h2>Stack & Uitgaven over Tijd</h2>
        <div class="chart-container" style="position: relative; height: 450px;">
          <canvas id="stack-chart" aria-label="BTC stack en uitgaven over tijd"></canvas>
        </div>
      </section>

      <!-- ── Jaar-voor-Jaar Tabel ─────────────────────────── -->
      <section id="table-section" class="hidden">
        <h2>Jaar-voor-Jaar Overzicht</h2>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Jaar</th>
                  <th>BTC Prijs</th>
                  <th>Trend</th>
                  <th>Veelvoud</th>
                  <th>Uitgaven</th>
                  <th>BTC Verkocht</th>
                  <th>Leningsaldo</th>
                  <th>Stack</th>
                  <th>Portfoliowaarde</th>
                  <th>SWR %</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="yearly-table-body">
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Kernpunt ────────────────────────────────── -->
      <section id="insight-section" class="hidden">
        <div class="info-box">
          <h4>Waarom Dit Belangrijk Is</h4>
          <p id="insight-text"></p>
        </div>
      </section>

    </div>
  </main>


  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodologie</h4>
          <p>Machtswettrend: verwacht groeipad. M2-groei: proxy voor reële inflatie. Leningen: lenen onder trend om stack te behouden. SWR: dynamisch, afnemend met machtswet-CAGR.</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Geen financieel advies. Alleen voor educatieve doeleinden.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Historische modelfit garandeert geen toekomstige prestaties. Doe altijd je eigen onderzoek.</p>
      </div>
    </div>
  </footer>

  <!-- Paginaspecifieke stijlen -->
  <style>
    /* Override global canvas height to respect container */
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    /* Ensure sections don't overlap */
    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .slider-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--orange);
      text-align: center;
    }

    .loans-toggle-section {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--gray-border);
    }

    .toggle-switch-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      flex-shrink: 0;
    }

    .toggle-switch input { display: none; }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: var(--gray-border);
      border-radius: 28px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      left: 3px;
      top: 3px;
      background: var(--white);
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: var(--orange);
    }

    .toggle-switch input:checked + .toggle-slider::before {
      transform: translateX(24px);
    }

    .toggle-label {
      font-weight: 500;
      font-size: 0.9375rem;
    }

    .loan-params {
      margin-top: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--gray-light);
      border-radius: var(--border-radius);
    }

    .hidden { display: none; }

    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    /* Status badges in table */
    .status-ok { color: var(--green); }
    .status-borrow { color: var(--orange); }
    .status-ruin { color: var(--red); font-weight: 700; }
    .status-sell { color: var(--gray); }

    .comparison-highlight {
      background: rgba(247, 147, 26, 0.08);
      font-weight: 600;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-banner.status-red {
      background: rgba(255, 23, 68, 0.08);
      border-left-color: var(--red);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content {
      flex: 1;
      min-width: 0;
    }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    .status-detail strong {
      color: var(--black);
    }

    .spending-growth-hint {
      font-size: 0.8125rem;
      color: var(--orange);
      margin-top: 2px;
      line-height: 1.4;
    }

    .year-input-row {
      display: flex;
      gap: var(--spacing-xs);
      align-items: stretch;
    }

    .year-input-row input {
      flex: 1;
      min-width: 0;
    }

    .now-btn {
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--orange);
      border-radius: var(--border-radius);
      background: rgba(247, 147, 26, 0.08);
      color: var(--orange);
      font-family: var(--font-family);
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .now-btn:hover {
      background: var(--orange);
      color: var(--white);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons, .loans-toggle-section,
      #input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }
  </style>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="../../js/powerlaw.js"></script>
  <script src="../../js/retirement.js"></script>
  <script src="../js/retirement-ui.js"></script>
</body>
</html>
