<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stormnavigatie Pensioenrekentool - Bitcoin Machtswet Observatorium</title>
  <meta name="description" content="Plan je pensioen met het Stormnavigatie raamwerk. Splits je Bitcoin stack in een Navigatiefonds en Eeuwige Helft met machtswetprojecties.">
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="../index.html" class="logo">
        <span class="logo-icon">&#x20BF;</span>
        Machtswet Observatorium
      </a>
      <nav class="nav" aria-label="Hoofdnavigatie">
        <a href="../index.html">Dashboard</a>
        <a href="history.html">Geschiedenis</a>
        <a href="future.html">Toekomst</a>
        <a href="dca.html">DCA</a>
        <a href="equity.html">Hypotheek</a>
        <a href="balance-sheet.html">Balans</a>
        <a href="retirement.html" class="active">Pensioen</a>
        <a href="about.html">Over</a>
      </nav>
      <div class="lang-toggle">
        <a href="../../pages/retirement.html" class="lang-link">EN</a>
        <span class="lang-sep">|</span>
        <a href="retirement.html" class="lang-link active">NL</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero">
        <h1>Stormnavigatie Pensioenrekentool</h1>
        <p>Het Navigatiefonds koopt je vrijheid. De Eeuwige Helft doorstaat de storm en wordt onuitputtelijk.</p>
      </section>

      <div class="disclaimer">
        <p><strong>Belangrijk:</strong> Dit is een educatief hulpmiddel gebaseerd op machtswetmodellen, geen financieel advies. Het model gaat ervan uit dat de machtswet blijft gelden. Werkelijke resultaten zullen afwijken. Doe altijd je eigen onderzoek en raadpleeg professionals.</p>
      </div>

      <!-- ── Modus Schakelaar ─────────────────────────── -->
      <div class="mode-toggle" id="v2-mode-toggle">
        <button class="toggle-btn active" data-mode="freedom_now">Vrijheid Nu</button>
        <button class="toggle-btn" data-mode="end_result">Eindresultaat</button>
      </div>

      <!-- ── Invoer Sectie ───────────────────────────── -->
      <div class="card" id="v2-input-section">

        <!-- Gedeelde Invoer -->
        <h3>Jouw Stack</h3>
        <div class="input-grid">
          <div class="input-group">
            <label for="v2-total-btc">Totaal Bitcoin Bezit (BTC)</label>
            <input type="number" id="v2-total-btc" value="1.0" min="0.001" step="0.01">
          </div>

          <div class="input-group">
            <label for="v2-currency">Valuta</label>
            <select id="v2-currency">
              <option value="USD" selected>$ USD</option>
              <option value="EUR">&euro; EUR</option>
            </select>
          </div>

          <div class="input-group">
            <label for="v2-price-scenario">Prijsscenario</label>
            <select id="v2-price-scenario">
              <option value="cyclical" selected>Cyclisch (&plusmn;1&sigma;, verlengde periodes)</option>
              <option value="cyclical_bear">Bear Bias Cycli (60% onder trend)</option>
              <option value="smooth_trend">Vlakke Trend (op trendlijn)</option>
              <option value="smooth_bear">Bear (vlak &minus;1&sigma; onder trend)</option>
              <option value="smooth_deep_bear">Diepe Bear (vlak &minus;2&sigma; onder trend)</option>
            </select>
          </div>
        </div>

        <!-- Navigatiefonds / Eeuwig Verdeling -->
        <div class="split-section">
          <h3>Navigatiefonds / Eeuwig Verdeling</h3>
          <p style="color: var(--gray); font-size: 0.9375rem;">Het Navigatiefonds financiert je leven tijdens de stormperiode. De Eeuwige Helft groeit langs de machtswet totdat opnames verwaarloosbaar worden.</p>
          <div class="split-slider-row">
            <span class="split-label">Fonds: <strong id="v2-split-bridge-value">50</strong>%</span>
            <input type="range" id="v2-bridge-split" min="10" max="90" step="5" value="50">
            <span class="split-label">Eeuwig: <strong id="v2-split-forever-value">50</strong>%</span>
          </div>
        </div>

        <!-- ── Vrijheid Nu Invoer ──────────────────────── -->
        <div id="v2-freedom-inputs">
          <h3>Levensonderhoud</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="v2-annual-burn">Jaarlijkse Uitgaven (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-annual-burn" value="50000" min="1000" step="1000">
            </div>

            <div class="input-group">
              <label for="v2-retirement-year">Startjaar Pensioen</label>
              <div class="year-input-row">
                <input type="number" id="v2-retirement-year" value="2030" min="2024" max="2060" step="1">
                <button type="button" class="now-btn" id="v2-start-now-btn" title="Start pensioen dit jaar">Nu</button>
              </div>
            </div>

            <div class="input-group">
              <label for="v2-spending-growth">Jaarlijkse Uitgavengroei (%)</label>
              <input type="range" id="v2-spending-growth" min="0" max="12" step="0.5" value="6.5">
              <div class="slider-value"><span id="v2-spending-growth-value">6.5</span>%</div>
            </div>

            <div class="input-group">
              <label>Eeuwige Helft SWR</label>
              <div class="slider-value" id="v2-forever-swr-display" style="font-size: 1.125rem;">&mdash;</div>
              <div style="color: var(--gray); font-size: 0.8rem;">25% &times; verwacht rendement voor pensioenjaar</div>
            </div>

            <div class="input-group">
              <label for="v2-swr-normal">Basis Opnamepercentage (%)</label>
              <input type="range" id="v2-swr-normal" min="1" max="8" step="0.5" value="4">
              <div class="slider-value"><span id="v2-swr-value">4</span>%</div>
            </div>
          </div>
        </div>

        <!-- ── Eindresultaat Invoer ───────────────────── -->
        <div id="v2-endresult-inputs" class="hidden">
          <h3>Stapelplan</h3>
          <div class="input-grid">
            <div class="input-group">
              <label for="v2-additional-years">Jaren Doorstapelen</label>
              <input type="number" id="v2-additional-years" value="5" min="1" max="30" step="1">
            </div>

            <div class="input-group">
              <label for="v2-monthly-dca">Maandelijks DCA Bedrag (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-monthly-dca" value="500" min="50" step="50">
            </div>

            <div class="input-group">
              <label for="v2-income-growth">Jaarlijkse Inkomensgroei (%)</label>
              <input type="range" id="v2-income-growth" min="0" max="10" step="0.5" value="3">
              <div class="slider-value"><span id="v2-income-growth-value">3</span>%</div>
            </div>

            <div class="input-group">
              <label for="v2-annual-burn-er">Jaarlijkse Uitgaven bij Pensioen (<span class="v2-currency-label">$</span>)</label>
              <input type="number" id="v2-annual-burn-er" value="50000" min="1000" step="1000">
            </div>
          </div>
        </div>

        <button class="calculate-btn" id="v2-calculate-btn">Bereken Pensioenplan</button>
        <button class="calculate-btn secondary" id="v2-compare-btn">Vergelijk Alle Scenario's</button>

        <!-- Actieknoppen (getoond na berekening) -->
        <div class="action-buttons hidden" id="v2-action-buttons">
          <button class="calculate-btn secondary" id="v2-sidebyside-btn">Zij-aan-Zij Vergelijking</button>
          <button class="calculate-btn secondary" id="v2-montecarlo-btn">Monte Carlo Analyse</button>
          <button class="calculate-btn secondary" id="v2-export-pdf-btn">Opslaan als PDF</button>
          <button class="calculate-btn secondary" id="v2-reset-btn">Standaardwaarden Herstellen</button>
        </div>

        <!-- Statusbanner -->
        <div id="v2-status-banner" class="status-banner hidden">
          <div class="status-icon" id="v2-status-icon"></div>
          <div class="status-content">
            <div class="status-headline" id="v2-status-headline"></div>
            <div class="status-detail" id="v2-status-detail"></div>
          </div>
        </div>
      </div>

      <!-- ── Stormperiode Sectie ──────────────────────── -->
      <section id="v2-storm-section" class="hidden">
        <h2>De Stormperiode</h2>
        <div id="v2-storm-content"></div>
      </section>

      <!-- ── Accumulatie Grafiek (Eindresultaat) ───────── -->
      <section id="v2-accum-chart-section" class="hidden">
        <h2>Accumulatiefase</h2>
        <p>Je BTC stack groeit tijdens de stapeljaren door maandelijkse DCA-aankopen.</p>
        <div class="chart-container" style="position: relative; height: 350px;">
          <canvas id="v2-accum-chart" aria-label="BTC accumulatie over tijd"></canvas>
        </div>
      </section>

      <!-- ── Navigatiefonds Grafiek ──────────────────────── -->
      <section id="v2-bridge-chart-section" class="hidden">
        <h2>Navigatiefonds Projectie</h2>
        <p>Je actieve kapitaal: opnames en de tactische strijd om de storm te overleven.</p>
        <div class="chart-container" style="position: relative; height: 450px;">
          <canvas id="v2-bridge-chart" aria-label="Navigatiefonds projectie over tijd"></canvas>
        </div>
      </section>

      <!-- ── Eeuwige Helft Grafiek ────────────────────── -->
      <section id="v2-forever-chart-section" class="hidden">
        <h2>Eeuwige Helft Projectie</h2>
        <p>Je gereserveerd kapitaal: groeiend langs de machtswetcurve totdat je uitgaven een afrondingsfout worden.</p>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="v2-forever-chart" aria-label="Eeuwige Helft waarde vs jaarlijkse uitgaven"></canvas>
        </div>
      </section>

      <!-- ── Samenvattingskaarten ─────────────────────── -->
      <section id="v2-results-section" class="hidden">
        <h2>Pensioen Samenvatting</h2>
        <div class="dashboard" id="v2-summary-cards"></div>
      </section>

      <!-- ── Vergelijkingssectie ──────────────────────── -->
      <section id="v2-comparison-section" class="hidden">
        <h2>Scenariovergelijking</h2>
        <p>Hoe je Stormnavigatie plan standhoudt onder verschillende prijsscenario's.</p>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Stormperiode</th>
                <th>Fonds Overleeft</th>
                <th>Minimale BTC</th>
                <th>Gem. SWR</th>
              </tr>
            </thead>
            <tbody id="v2-comparison-body"></tbody>
          </table>
        </div>
      </section>

      <!-- ── Jaar-voor-Jaar Tabel ────────────────────── -->
      <section id="v2-table-section" class="hidden">
        <h2>Jaar-voor-Jaar Overzicht</h2>
        <div class="table-container">
          <div class="weekly-table-wrapper" style="max-height: 500px;">
            <table>
              <thead>
                <tr>
                  <th>Jaar</th>
                  <th>BTC Prijs</th>
                  <th>Veelvoud</th>
                  <th>SWR</th>
                  <th>Opname</th>
                  <th>BTC Verkocht</th>
                  <th>Fonds BTC</th>
                  <th>Fondswaarde</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="v2-yearly-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ── Kernpunt ───────────────────────────────── -->
      <section id="v2-insight-section" class="hidden">
        <div class="info-box">
          <h4>Het Stormnavigatie Inzicht</h4>
          <p id="v2-insight-text"></p>
        </div>
      </section>

      <!-- ── Zij-aan-Zij Vergelijking ────────────────── -->
      <section id="v2-sidebyside-section" class="hidden">
        <h2>Vrijheid Nu vs. Eindresultaat</h2>
        <p>Vergelijk nu met pensioen gaan met nog een paar jaar stapelen.</p>
        <div id="v2-sidebyside-content"></div>
      </section>

      <!-- ── Monte Carlo Analyse ─────────────────────── -->
      <section id="v2-montecarlo-section" class="hidden">
        <h2>Monte Carlo Analyse</h2>
        <p>200 willekeurige prijssimulaties rond de machtswettrend. Hoe vaak overleeft je Navigatiefonds de storm?</p>
        <div id="v2-montecarlo-summary" style="margin-bottom: var(--spacing-md);"></div>
        <div class="chart-container" style="position: relative; height: 400px;">
          <canvas id="v2-montecarlo-chart" aria-label="Monte Carlo navigatiefonds overlevingskans banden"></canvas>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Methodologie</h4>
          <p>Navigatiefonds: actieve onttrekking met dynamisch opnamepercentage (past aan 1%&ndash;6% op basis van prijs vs. machtswettrend). Eeuwige Helft: passieve groei langs machtswetcurve. Stormperiode: jaren totdat uitgaven onder het duurzame opnamepercentage (25% &times; verwacht rendement) van de Eeuwige waarde komen.</p>
        </div>
        <div class="footer-section">
          <h4>Disclaimer</h4>
          <p>Geen financieel advies. Alleen voor educatieve doeleinden.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Historische modelfit garandeert geen toekomstige prestaties. Doe altijd je eigen onderzoek.</p>
      </div>
    </div>
  </footer>

  <!-- Paginaspecifieke stijlen -->
  <style>
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
    }

    section {
      position: relative;
      z-index: 1;
      margin-bottom: var(--spacing-xl);
    }

    .hidden { display: none; }

    /* Modus Schakelaar */
    .mode-toggle {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: var(--spacing-xl);
      border: 2px solid var(--black);
      border-radius: var(--border-radius);
      overflow: hidden;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .mode-toggle .toggle-btn {
      flex: 1;
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      background: var(--white);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      color: var(--gray);
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-toggle .toggle-btn.active {
      background: var(--black);
      color: var(--white);
    }

    .mode-toggle .toggle-btn:not(.active):hover {
      background: var(--gray-light);
    }

    /* Invoer Raster */
    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .input-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray);
    }

    .input-group input[type="number"],
    .input-group select {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--gray-border);
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      background: var(--white);
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--orange);
    }

    .slider-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--orange);
      text-align: center;
    }

    /* Verdeling Slider */
    .split-section {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--gray-border);
    }

    .split-slider-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-md);
    }

    .split-slider-row input[type="range"] {
      flex: 1;
    }

    .split-label {
      font-size: 0.9375rem;
      font-weight: 500;
      white-space: nowrap;
      min-width: 110px;
    }

    .split-label:last-child {
      text-align: right;
    }

    /* Knoppen */
    .calculate-btn {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius);
      font-family: var(--font-family);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: var(--spacing-md);
      margin-right: var(--spacing-sm);
    }

    .calculate-btn:not(.secondary) {
      background: var(--orange);
      color: var(--white);
    }

    .calculate-btn:not(.secondary):hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .calculate-btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 1px solid var(--gray-border);
    }

    .calculate-btn.secondary:hover {
      border-color: var(--orange);
      color: var(--orange);
    }

    .year-input-row {
      display: flex;
      gap: var(--spacing-xs);
      align-items: stretch;
    }

    .year-input-row input {
      flex: 1;
      min-width: 0;
    }

    .now-btn {
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--orange);
      border-radius: var(--border-radius);
      background: rgba(247, 147, 26, 0.08);
      color: var(--orange);
      font-family: var(--font-family);
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .now-btn:hover {
      background: var(--orange);
      color: var(--white);
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }

    /* Statusbanner */
    .status-banner {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-lg);
      border-left: 4px solid;
      animation: statusFadeIn 0.3s ease-out;
    }

    @keyframes statusFadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .status-banner.status-green {
      background: rgba(0, 200, 83, 0.08);
      border-left-color: var(--green);
    }

    .status-banner.status-amber {
      background: rgba(247, 147, 26, 0.08);
      border-left-color: var(--orange);
    }

    .status-banner.status-red {
      background: rgba(255, 23, 68, 0.08);
      border-left-color: var(--red);
    }

    .status-icon {
      font-size: 2rem;
      line-height: 1;
      flex-shrink: 0;
    }

    .status-content { flex: 1; min-width: 0; }

    .status-headline {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--black);
      margin-bottom: var(--spacing-xs);
    }

    .status-detail {
      font-size: 0.9375rem;
      color: var(--gray);
      line-height: 1.5;
    }

    /* Stormperiode */
    .storm-summary {
      background: var(--gray-light);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
    }

    .storm-metrics-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--spacing-md);
    }

    .storm-metric {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .storm-label {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .storm-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--black);
    }

    /* Tabel statussen */
    .status-ok { color: var(--green); }
    .status-ruin { color: var(--red); font-weight: 700; }
    .status-sell { color: var(--gray); }

    @media print {
      .header, .footer, .nav, .hero, .disclaimer,
      .calculate-btn, .action-buttons, .mode-toggle,
      #v2-input-section { display: none !important; }
      .hidden { display: block !important; }
      body { background: white; }
      .container { max-width: 100%; padding: 0; }
      section { page-break-inside: avoid; margin-bottom: 1rem; }
      .chart-container { height: 300px !important; }
    }

    @media (max-width: 768px) {
      .split-slider-row {
        flex-direction: column;
        align-items: stretch;
      }
      .split-label:last-child {
        text-align: left;
      }
      .mode-toggle {
        max-width: 100%;
      }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../../js/powerlaw.js"></script>
  <script src="../../js/retirement.js"></script>
  <script src="../../js/retirement-v2.js"></script>
  <script src="../js/retirement-v2-ui.js"></script>
</body>
</html>
